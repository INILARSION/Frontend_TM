<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Turing Machine</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "Roboto Light", sans-serif;
        }

        #header {
            padding-top: 1vh;
            padding-left: 1vw;
            width: 99vw;
            height: 4vh;
            background-color: #3F51B5;
            vertical-align: center;
            color: white;
            font-size: 2vh;
            box-shadow: 0 1px 5px #000000;
        }

        #content {
            display: grid;
            min-height: 90vh;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 4fr 4fr;
            grid-template-areas: "type type" "program tape" "output output";

        }

        #input {
            display: inline-block;
        }

        .selected_setting {
            background-color:#86A8E7;
        }

        #program, #tape, #output {
            margin-right: 1vw;
            margin-left: 1vw;
        }

        #program {
            grid-area: program;
        }

        #tape {
            grid-area: tape;
        }

        #type-picker {
            grid-area: type;
        }

        #type-picker button {
            padding: 1vh 1vw;
            margin-top: 2vh;
            margin-left: 9%;
            border-style: none;
            border-color: Transparent;
            box-shadow: 0 0 8px #868585;
        }

        textarea {
            height: 35vh;
            width: 100%;
            border-style: none;
            border-color: Transparent;
            overflow: auto;
            box-shadow: 0 1px 5px #000000;
        }
        #output {
            grid-area: output;
        }

        #submit_div {
            margin-left: 75vw;
            font-size: 1.5vh;
        }

        #makro_div {
            display: inline;
        }

        #makro {
            transform: scale(1.5);
        }


        #submit {
            margin-left: 2vw;
            padding: 1vh 1vw;
            font-size: 2vh;
            border-style: none;
            border-color: Transparent;
            box-shadow: 0 1px 5px #000000;
        }

        #help {
            margin-right: 0.5vw;
            padding: 0.4vh 0.4vw;
            font-size: 1.4vh;
            border-style: none;
            border-color: Transparent;
            box-shadow: 0 1px 5px #000000;
        }
    </style>
</head>
<body>

<div id="header">
    <div id="name">
        Turing Machine
    </div>
</div>

<div id="content">

    <div id="type-picker">
        <button id="TM" class="picker-btn selected_setting">Turing Machine</button>
        <button id="Multitape_TM" class="picker-btn">Multitape Turing Machine</button>
        <button id="Nondeterministic" class="picker-btn">Nondeterministic Turing Machine</button>
        <button id="Multitape_Compiler" class="picker-btn">Multitape Compiler</button>
        <button id="High-level" class="picker-btn">High-level Compiler</button>
    </div>

    <div id="program">
        Program:<br/>
        <textarea id="program_text" name="program" >

        </textarea>
    </div>

    <div id="tape">
        Tape:<br/>
        <textarea  id="tape_text" name="tape">

        </textarea>
    </div>

    <div id="output">
        Output:<br/>
        <textarea id="output_text" readonly>

    </textarea>
    </div>

  </div>

    <div id="submit_div">
        <button id="help">
            help
        </button>
        <div id="makro_div">
            Makro Compiler:
            <input id="makro" type="checkbox">
        </div>

        <button id="submit">
            Submit
        </button>
    </div>
<script>
    let picker_btns = document.getElementsByClassName("picker-btn");
    let submit_btn = document.getElementById("submit");
    let help_btn = document.getElementById("help");
    let program_area = document.getElementById("program_text");
    let tape_area = document.getElementById("tape_text");
    let output_area = document.getElementById("output_text");
    let makro_checkbox = document.getElementById("makro");
    let makro_div = document.getElementById("makro_div");
    let supports_makro_compiler = ["TM", "Nondeterministic"];
    let no_tape = ["High-level"];

    // remove weird spaces
    tape_area.value = "";
    program_area.value = "";
    output_area.value = "";

    function picker_handler (active_element) {
        let old_element = document.getElementsByClassName("selected_setting")[0];
        old_element.classList.remove("selected_setting");
        old_element.setAttribute("style", "background-color:#F0F0F0;");

        if (supports_makro_compiler.includes(active_element.id)) {
            makro_checkbox.removeAttribute("disabled");
            makro_div.setAttribute("color", "black");
            makro_div.style.color = "black";
        } else {
            makro_checkbox.setAttribute("disabled", "disabled");
            makro_div.setAttribute("color", "gray");
            makro_div.style.color = "gray";
        }

        if (no_tape.includes(active_element.id)) {
            tape_area.setAttribute("readonly", "readonly");
        } else {
            tape_area.removeAttribute("readonly");
        }

        active_element.setAttribute("style","background-color:#86A8E7");
        active_element.setAttribute("class", "selected_setting");
    }

    function show_help() {
        let active_tm = document.getElementsByClassName("selected_setting")[0];
        let alert_text;
        switch (active_tm.id) {
            case "TM":
                alert_text = "This is a standard Turing machine Simulator.\nA Turing machine is described as a 7-tuple of:\n- A set of states\n- An initial state contained in the states\n- An accepting state contained in the states\n- A finite alphabet\n- Tape alphabet symbols\n- A blank symbol which is contained in the alphabet\n- Transition function\n\nA transition function has the following components:\nstate,read_symbol,subsequent_state,write_symbol,movement_direction\nValues for movement_directions are '<', '-' and '>'\n\nThe program of a Turing machine starts in the first line with a listing of all states. The line starts with 'S: ', followed by all states, divides by a comma. The first state listet is the start state, the second the accepting state and the third the rejecting state. All used states have to be listet. The second line contains all used alphabet symbols. The line starts with 'G: ', followed by all symbols divided by a comma. All following lines contain the transitions. A line start with 'D: ', followed by the transition.\n\nThe tape contains one line with the initial tape configuration, consisting of the symbols divided by a pipe '|'.\n\nHere is an example of a program, it just flips all 0s to 1s:\n\nS: start,acc,rej,s1,s2\nG:  ,0,1\nD: start,0,s1,1,>\nD: start, ,rej, ,-\nD: start,1,acc,1,-\nD: s1,0,s1,1,>\nD: s1,1,acc,1,-\nD: s1, ,acc, ,-\n\nHere is an example of a tape:\n0|0|0|0| | ";
                break;

            case "Multitape_Compiler":
                alert_text = "This is a compiler for multitape Turing machine programs to standard Turing machine programs.\n\nIt compiles programs for a multitape Turing machine and tapes for this turing machine to a program and a band, which can be executed on a standard turing machine.\n\nA Turing machine is described as a 7-tuple of:\n- A set of states\n- An initial state contained in the states\n- An accepting state contained in the states\n- A finite alphabet\n- Tape alphabet symbols\n- A blank symbol which is contained in the alphabet\n- Transition function\n\nA transition function has the following components:\nstate,read_symbols,subsequent_state,write_symbols,movement_directions\nValues for movement_directions are '<', '-' and '>'\n\nSince a multitape Turing machine has multiple tapes and heads, it also needs multiple read-/write-symbols and head movements per transition, whereas a standard Turing machine only needs one of each. The heads can move independently from each other.\n\nThe program of a Turing machine starts in the first line with a listing of all states. The line starts with 'S: ', followed by all states, divides by a comma. The first state listet is the start state, the second the accepting state and the third the rejecting state. All used states have to be listet. The second line contains all used alphabet symbols. The line starts with 'G: ', followed by all symbols divided by a comma. All following lines contain the transitions. A line start with 'D: ', followed by the transition.\n\nThe tape contains one line with the initial tape configuration, consisting of the symbols divided by a pipe '|'.\n\nHere is an example of a program with 3 tapes, it just flips all 0s to 1s on the first tape and all 1s to 0s on the second tape. The third tape just stays in place:\n\nS: start,acc,rej,s1,s2\nG:  ,0,1\nD: start,0|1| ,s1,1|0| ,>|>|-\nD: s1,0|1| ,s1,1|0| ,>|>|-\nD: start,1|0| ,acc,1|0| ,-|-|-\nD: s1,1|0| ,acc,1|0| ,-|-|-\nD: s1, | | ,acc, | | ,-|-|-\n\nHere is an example of a tape:\n0|0|0|0| |\n1|1|1|1| |\n | ";
                break;

            case "Multitape_TM":
                alert_text = "This is a multitape Turing machine Simulator.\nA Turing machine is described as a 7-tuple of:\n- A set of states\n- An initial state contained in the states\n- An accepting state contained in the states\n- A finite alphabet\n- Tape alphabet symbols\n- A blank symbol which is contained in the alphabet\n- Transition function\n\nA transition function has the following components:\nstate,read_symbols,subsequent_state,write_symbols,movement_directions\nValues for movement_directions are '<', '-' and '>'\n\nSince a multitape Turing machine has multiple tapes and heads, it also needs multiple read-/write-symbols and head movements per transition, whereas a standard Turing machine only needs one of each. The heads can move independently from each other.\n\nThe program of a Turing machine starts in the first line with a listing of all states. The line starts with 'S: ', followed by all states, divides by a comma. The first state listet is the start state, the second the accepting state and the third the rejecting state. All used states have to be listet. The second line contains all used alphabet symbols. The line starts with 'G: ', followed by all symbols divided by a comma. All following lines contain the transitions. A line start with 'D: ', followed by the transition.\n\nThe tape contains one line with the initial tape configuration, consisting of the symbols divided by a pipe '|'.\n\nHere is an example of a program with 3 tapes, it just flips all 0s to 1s on the first tape and all 1s to 0s on the second tape. The third tape just stays in place:\n\nS: start,acc,rej,s1,s2\nG:  ,0,1\nD: start,0|1| ,s1,1|0| ,>|>|-\nD: s1,0|1| ,s1,1|0| ,>|>|-\nD: start,1|0| ,acc,1|0| ,-|-|-\nD: s1,1|0| ,acc,1|0| ,-|-|-\nD: s1, | | ,acc, | | ,-|-|-\n\nHere is an example of a tape:\n0|0|0|0| |\n1|1|1|1| |\n | ";
                break;

            case "Nondeterministic":
                alert_text = "This is a nondeterministic Turing machine Simulator.\nA Turing machine is described as a 7-tuple of:\n- A set of states\n- An initial state contained in the states\n- An accepting state contained in the states\n- A finite alphabet\n- Tape alphabet symbols\n- A blank symbol which is contained in the alphabet\n- Transition function\n\nThe difference compared to the standard Turing machine is that multiple transitions can be possible at any time.\n\nA transition function has the following components:\nstate,read_symbol,subsequent_state,write_symbol,movement_direction\nValues for movement_directions are '<', '-' and '>'\nThe program of a Turing machine starts in the first line with a listing of all states. The line starts with 'S: ', followed by all states, divides by a comma. The first state listet is the start state, the second the accepting state and the third the rejecting state. All used states have to be listet. The second line contains all used alphabet symbols. The line starts with 'G: ', followed by all symbols divided by a comma. All following lines contain the transitions. A line start with 'D: ', followed by the transition.\n\nThe tape contains one line with the initial tape configuration, consisting of the symbols divided by a pipe '|'.\n\nHere is an example of a program, it just flips all 0s to 1s:\n\nS: start,acc,rej,s1,s2\nG:  ,0,1\nD: start,0,s1,1,>\nD: start, ,rej, ,-\nD: start,1,acc,1,-\nD: s1,0,s1,1,>\nD: s1,1,acc,1,-\nD: s1, ,acc, ,-\n\nHere is an example of a tape:\n0|0|0|0| | ";
                break;

            case "High-level":
                alert_text = "This is a high level to multitape Turing machine compiler.\n\nIt compiles programs written in a high level language to programs for the multitape Turing machine.\n\nBefore any operation can be executed, all variables of the program have to be initialized. The only datatype is an integer.\nAn initialization looks like:\n\na = 10\ncounter = 0\n\nAfterwards these can be used in the operations. The following operations are available:\n\naddition:\na = a + b\nsubtraction:\na = a - b\nincrement:\nincr a\ndecrement:\ndecr a\njump to a line number:\ngoto 6\nconditional jump to a line number:\nif a == b then 3 else 5\ncomment:\n// this is a comment\n\nAvailable comparissons are:\n==, !=, <, <=, >, >=\n\nHere is an example of a high level program:\n\na = 5\nb = 10\n// initialization endet here, now operations can start\na = a + b\nif a > b then 6 else 8\nincr a\ngoto 9\ndecr a\n\na = a - b";
                break;
        }

        window.alert(alert_text);
    }

    function submit_data() {
        let selected_type = document.getElementsByClassName("selected_setting")[0];
        let TM_input = {
            "type": selected_type.id,
            "program": program_area.value,
            "tape": tape_area.value,
            "makro": makro_checkbox.checked,
        }

        fetch("/run_tm/", {
          method: "POST",
          body: JSON.stringify(TM_input)
        }).then(res => res.text()).then(data => {
            let data_obj = JSON.parse(data);
            console.log(data_obj);
            if (data_obj["Returncode"] === 0) {
                output_area.value = data_obj["Output"];
                if (data_obj["Tape"] !== null) {
                    tape_area.value = data_obj["Tape"];
                }
            } else {
                output_area.value = `Returncode: ${data_obj["Returncode"]}\n${data_obj["Error"]}`;
            }
        });
    }

    submit_btn.onclick = submit_data;
    help_btn.onclick = show_help;

    for (let picker_btn of picker_btns) {
        picker_btn.onclick = _ => picker_handler(picker_btn)
    }
</script>

</body>
</html>